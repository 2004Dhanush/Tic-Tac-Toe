<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tic Tac Toe Pro - Enhanced Multiplayer</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --primary: #667eea;
      --secondary: #764ba2;
      --accent: #f5576c;
      --success: #4caf50;
      --dark: #1a1a2e;
      --light: #ffffff;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, var(--dark) 0%, #2d2d44 100%);
      color: var(--light);
      text-align: center;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .container { width: 100%; max-width: 600px; }
    h1 { font-size: 2.5rem; margin-bottom: 10px; background: linear-gradient(135deg, var(--primary), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    h2 { font-size: 1.8rem; margin: 20px 0; color: var(--light); }
    .section {
      padding: 40px 30px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      margin: 20px 0;
      animation: slideIn 0.3s ease;
    }
    @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    input { width: 250px; padding: 12px 20px; margin: 10px; font-size: 1rem; border-radius: 10px; border: 2px solid rgba(255, 255, 255, 0.3); background: rgba(255, 255, 255, 0.9); color: #333; text-align: center; outline: none; transition: all 0.3s ease; }
    input:focus { background: var(--light); border: 2px solid var(--primary); box-shadow: 0 0 10px rgba(102, 126, 234, 0.5); transform: scale(1.02); }
    button {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: var(--light);
      padding: 13px 30px;
      margin: 10px;
      font-size: 1.1rem;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 150px;
      font-weight: 600;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }
    button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3); }
    button.secondary { background: rgba(255, 255, 255, 0.1); border: 2px solid rgba(255, 255, 255, 0.2); }
    button.secondary:hover { background: rgba(255, 255, 255, 0.15); }
    .mode-buttons { display: flex; flex-direction: column; gap: 15px; margin: 20px 0; }
    .mode-btn { padding: 15px 30px; font-size: 1.1rem; width: 100%; }
    .stats-card {
      background: rgba(255, 255, 255, 0.12);
      padding: 20px;
      border-radius: 15px;
      margin: 15px 0;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .stat-item { background: rgba(255, 255, 255, 0.08); padding: 15px; border-radius: 10px; border: 1px solid rgba(255, 255, 255, 0.1); }
    .stat-label { font-size: 0.9rem; opacity: 0.8; display: block; margin-bottom: 5px; }
    .stat-value { font-size: 1.8rem; display: block; color: var(--primary); font-weight: bold; }
    .board { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; justify-content: center; margin: 30px auto; max-width: 350px; }
    .cell {
      width: 100px;
      height: 100px;
      font-size: 2.5rem;
      background: rgba(255, 255, 255, 0.95);
      color: #333;
      cursor: pointer;
      border-radius: 15px;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      font-weight: bold;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    .cell:hover:not(:disabled) { transform: scale(1.05); box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2); background: var(--light); }
    .cell:disabled { cursor: not-allowed; }
    .cell.X { color: var(--primary); font-weight: bold; }
    .cell.O { color: var(--accent); font-weight: bold; }
    .cell.winner { background: linear-gradient(135deg, var(--primary), var(--accent)); color: var(--light); animation: pulse 0.5s; }
    @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
    .turn-indicator { font-size: 1.3rem; margin: 15px 0; padding: 15px; background: rgba(102, 126, 234, 0.2); border-radius: 10px; font-weight: bold; border: 2px solid rgba(102, 126, 234, 0.3); }
    .popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, var(--dark), #2d2d44);
      border: 2px solid rgba(102, 126, 234, 0.3);
      color: var(--light);
      padding: 40px 30px;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      text-align: center;
      min-width: 300px;
      animation: slideIn 0.3s ease;
    }
    .popup-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); z-index: 999; }
    .popup-overlay.active, .popup.active { display: block; }
    .popup p { font-size: 1.5rem; margin-bottom: 20px; font-weight: bold; }
    .popup button { margin: 8px; min-width: 120px; }
    .hidden { display: none !important; }
    .user-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding: 15px; background: rgba(102, 126, 234, 0.1); border-radius: 10px; border: 1px solid rgba(102, 126, 234, 0.2); }
    .room-code { background: rgba(255, 255, 255, 0.1); padding: 10px 20px; border-radius: 8px; margin: 10px 0; font-family: 'Courier New', monospace; font-size: 1.2rem; color: var(--primary); border: 2px dashed rgba(102, 126, 234, 0.3); }
    @media (max-width: 480px) { h1 { font-size: 2rem; } h2 { font-size: 1.5rem; } .cell { width: 80px; height: 80px; font-size: 2rem; } .board { gap: 8px; max-width: 280px; } input { width: 90%; } }
  </style>
</head>
<body>
  <div class="container">
    <!-- LOGIN PAGE -->
    <div id="loginPage" class="section">
      <h1>üéÆ Tic Tac Toe Pro</h1>
      <h2>Login</h2>
      <p style="margin-bottom: 20px; opacity: 0.9;">Welcome! Login or create new account</p>
      <input type="text" id="loginUsername" placeholder="Username/Email" maxlength="50">
      <input type="password" id="loginPassword" placeholder="Password" maxlength="50">
      <button onclick="handleLogin()">üîì Login</button>
      <p style="margin-top: 20px; font-size: 0.9rem; opacity: 0.7;">Don't have an account? <span onclick="toggleSignup()" style="color: var(--primary); cursor: pointer; text-decoration: underline;">Sign up here</span></p>
      <div id="signupForm" class="hidden">
        <input type="text" id="signupUsername" placeholder="Choose Username" maxlength="50" style="margin-top: 15px;">
        <input type="password" id="signupPassword" placeholder="Create Password" maxlength="50">
        <button onclick="handleSignup()" style="margin-top: 10px;">‚úÖ Create Account</button>
      </div>
    </div>

    <!-- MODE SELECTION PAGE -->
    <div id="modePage" class="section hidden">
      <div class="user-info">
        <span>üë§ <span id="displayUsername"></span></span>
        <button class="secondary" onclick="handleLogout()" style="min-width: 100px; padding: 8px 15px; font-size: 0.9rem;">Logout</button>
      </div>
      <h1>üéÆ Tic Tac Toe</h1>
      <h2>üëã Select Game Mode</h2>
      <div class="stats-card">
        <div class="stat-item">
          <span class="stat-label">Wins</span>
          <span class="stat-value" id="winsDisplay">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Losses</span>
          <span class="stat-value" id="lossesDisplay">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Draws</span>
          <span class="stat-value" id="drawsDisplay">0</span>
        </div>
      </div>
      <div class="mode-buttons">
        <button class="mode-btn" onclick="startGameMode('vs-computer')">ü§ñ Play vs Computer</button>
        <button class="mode-btn" onclick="startGameMode('local-2p')">üë• Local Multiplayer (2 Players)</button>
        <button class="mode-btn" onclick="startGameMode('create-room')">üè† Create Custom Room</button>
        <button class="mode-btn" onclick="startGameMode('join-room')">üîó Join Room by Code</button>
        <button class="mode-btn" onclick="startGameMode('random-player')">üé≤ Play with Random Player</button>
      </div>
      <button onclick="resetStats()" style="background: rgba(255,50,50,0.3); margin-top: 20px;">üîÑ Reset Stats</button>
    </div>

    <!-- DIFFICULTY SELECTION PAGE -->
    <div id="difficultyPage" class="section hidden">
      <h1>ü§ñ Play vs Computer</h1>
      <h2>Select Difficulty</h2>
      <div class="mode-buttons" style="flex-direction: row; flex-wrap: wrap; justify-content: center;">
        <button class="mode-btn" onclick="selectDifficulty('easy')" style="width: auto; padding: 15px 25px;">üü¢ Easy</button>
        <button class="mode-btn" onclick="selectDifficulty('medium')" style="width: auto; padding: 15px 25px;">üü° Medium</button>
        <button class="mode-btn" onclick="selectDifficulty('hard')" style="width: auto; padding: 15px 25px;">üî¥ Hard</button>
      </div>
      <button onclick="backToMenu()" class="secondary" style="margin-top: 20px;">‚¨ÖÔ∏è Back</button>
    </div>

    <!-- CREATE ROOM PAGE -->
    <div id="createRoomPage" class="section hidden">
      <h1>üè† Create Custom Room</h1>
      <h2>Play with Friends</h2>
      <p style="margin: 15px 0; opacity: 0.8;">Create a room and share the code with your friend</p>
      <input type="text" id="roomName" placeholder="Room Name (Optional)" maxlength="30">
      <button onclick="createRoom()" style="margin-top: 10px;">üè† Create Room</button>
      <div id="roomInfo" class="hidden" style="margin-top: 20px;">
        <p style="margin-bottom: 10px; font-size: 1.1rem;">Room Code:</p>
        <div class="room-code" id="roomCodeDisplay"></div>
        <button onclick="copyRoomCode()" class="copy-btn">üìã Copy Code</button>
        <p id="waitingMessage" style="margin-top: 15px; opacity: 0.8;">‚è≥ Waiting for opponent...</p>
      </div>
      <button onclick="backToMenu()" class="secondary" style="margin-top: 20px;">‚¨ÖÔ∏è Back</button>
    </div>

    <!-- JOIN ROOM PAGE -->
    <div id="joinRoomPage" class="section hidden">
      <h1>üîó Join Room</h1>
      <h2>Play with Friends</h2>
      <p style="margin: 15px 0; opacity: 0.8;">Enter the room code shared by your friend</p>
      <input type="text" id="roomCodeInput" placeholder="Enter Room Code" maxlength="10" style="text-transform: uppercase;">
      <button onclick="joinRoom()" style="margin-top: 10px;">üîó Join Room</button>
      <button onclick="backToMenu()" class="secondary" style="margin-top: 20px;">‚¨ÖÔ∏è Back</button>
    </div>

    <!-- GAME PAGE -->
    <div id="gamePage" class="section hidden">
      <h1>üéÆ Tic Tac Toe</h1>
      <h2 id="gameTitle"></h2>
      <div class="turn-indicator" id="turnIndicator"></div>
      <div class="board" id="board"></div>
      <button onclick="backToMenu()" class="secondary" style="margin-top: 20px;">‚¨ÖÔ∏è Back to Menu</button>
    </div>
  </div>

  <!-- POPUP -->
  <div id="popupOverlay" class="popup-overlay"></div>
  <div id="popup" class="popup">
    <p id="popupMessage"></p>
    <div id="popupButtons">
      <button onclick="backToMenu()">‚Ü©Ô∏è Back to Menu</button>
      <button onclick="restartGame()">üîÑ Play Again</button>
    </div>
  </div>

  <!-- AUDIO -->
  <audio id="moveSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_b7d215b64a.mp3?filename=click-124467.mp3"></audio>
  <audio id="winSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_729d11b616.mp3?filename=success-1-6297.mp3"></audio>
  <audio id="drawSound" src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_d785ffb6a5.mp3?filename=error-126627.mp3"></audio>

  <script>
    // DOM Elements
    const moveSound = document.getElementById('moveSound');
    const winSound = document.getElementById('winSound');
    const drawSound = document.getElementById('drawSound');
    const boardElement = document.getElementById('board');
    const popup = document.getElementById('popup');
    const popupMessage = document.getElementById('popupMessage');
    const popupOverlay = document.getElementById('popupOverlay');

    // Game State
    let board = ["", "", "", "", "", "", "", "", ""];
    let currentPlayer = "X";
    let gameOver = false;
    let gameMode = "vs-computer";
    let difficulty = "medium";
    let currentUser = localStorage.getItem('tictactoeUser') || null;
    let users = JSON.parse(localStorage.getItem('tictactoeUsers') || '{}');
    let stats = {};
    let roomCode = null;
    let isRoomCreator = false;

    // Initialize
    function init() {
      if (currentUser && users[currentUser]) {
        showPage('modePage');
        displayUsername();
        loadStats();
        updateStatsDisplay();
      } else {
        showPage('loginPage');
      }
    }

    function showPage(pageName) {
      document.querySelectorAll('[id$="Page"]').forEach(page => page.classList.add('hidden'));
      document.getElementById(pageName).classList.remove('hidden');
    }

    function handleLogin() {
      const username = document.getElementById('loginUsername').value.trim();
      const password = document.getElementById('loginPassword').value;
      if (!username || !password) { alert('Please fill all fields'); return; }
      if (users[username] && users[username].password === password) {
        currentUser = username;
        localStorage.setItem('tictactoeUser', currentUser);
        document.getElementById('loginUsername').value = '';
        document.getElementById('loginPassword').value = '';
        showPage('modePage');
        displayUsername();
        loadStats();
        updateStatsDisplay();
      } else {
        alert('Invalid username or password. Try signup!');
      }
    }

    function toggleSignup() {
      document.getElementById('signupForm').classList.toggle('hidden');
    }

    function handleSignup() {
      const username = document.getElementById('signupUsername').value.trim();
      const password = document.getElementById('signupPassword').value;
      if (!username || !password) { alert('Please fill all fields'); return; }
      if (users[username]) { alert('Username already exists!'); return; }
      users[username] = { password, stats: { wins: 0, losses: 0, draws: 0 } };
      localStorage.setItem('tictactoeUsers', JSON.stringify(users));
      alert('Account created! Now login.');
      document.getElementById('signupForm').classList.add('hidden');
      document.getElementById('signupUsername').value = '';
      document.getElementById('signupPassword').value = '';
    }

    function handleLogout() {
      if (confirm('Are you sure you want to logout?')) {
        currentUser = null;
        localStorage.removeItem('tictactoeUser');
        showPage('loginPage');
        document.getElementById('loginUsername').value = '';
        document.getElementById('loginPassword').value = '';
      }
    }

    function displayUsername() {
      document.getElementById('displayUsername').textContent = currentUser || 'User';
    }

    function startGameMode(mode) {
      gameMode = mode;
      if (mode === 'vs-computer') {
        showPage('difficultyPage');
      } else if (mode === 'local-2p') {
        startGame();
        document.getElementById('gameTitle').textContent = 'üë• Local Multiplayer';
      } else if (mode === 'create-room') {
        showPage('createRoomPage');
      } else if (mode === 'join-room') {
        showPage('joinRoomPage');
      } else if (mode === 'random-player') {
        alert('\ud83d\udd17 Connecting to random player...');
        setTimeout(() => {
          startGame();
          document.getElementById('gameTitle').textContent = 'üé≤ Playing with Random Player';
        }, 1500);
      }
    }

    function selectDifficulty(level) {
      difficulty = level;
      startGame();
      document.getElementById('gameTitle').textContent = `ü§ñ Playing (${level.toUpperCase()})`;
      showPage('gamePage');
    }

    function createRoom() {
      const roomName = document.getElementById('roomName').value.trim() || 'Room';
      roomCode = Math.random().toString(36).substring(2, 8).toUpperCase();
      isRoomCreator = true;
      document.getElementById('roomCodeDisplay').textContent = roomCode;
      document.getElementById('roomInfo').classList.remove('hidden');
    }

    function copyRoomCode() {
      navigator.clipboard.writeText(roomCode);
      alert('‚úÖ Room code copied to clipboard!');
    }

    function joinRoom() {
      const code = document.getElementById('roomCodeInput').value.trim().toUpperCase();
      if (!code) { alert('Please enter room code'); return; }
      roomCode = code;
      isRoomCreator = false;
      alert('‚úÖ Joining room ' + code);
      setTimeout(() => {
        startGame();
        document.getElementById('gameTitle').textContent = 'üë• Playing Online';
        showPage('gamePage');
      }, 1500);
    }

    function startGame() {
      board = ["", "", "", "", "", "", "", "", ""];
      currentPlayer = "X";
      gameOver = false;
      renderBoard();
      updateTurnIndicator();
      showPage('gamePage');
    }

    function renderBoard() {
      boardElement.innerHTML = "";
      board.forEach((cell, index) => {
        const button = document.createElement("button");
        button.className = "cell";
        if (cell) {
          button.textContent = cell;
          button.classList.add(cell);
          button.disabled = true;
        }
        button.addEventListener("click", () => handleClick(index));
        boardElement.appendChild(button);
      });
    }

    function handleClick(index) {
      if (board[index] !== "" || gameOver) return;
      board[index] = currentPlayer;
      moveSound.play();
      renderBoard();
      if (checkWinner(currentPlayer)) {
        winSound.play();
        if (gameMode === 'vs-computer') {
          showPopup('üéâ You Win!');
          stats.wins++;
        } else {
          showPopup(`üéâ Player ${currentPlayer} Wins!`);
        }
        gameOver = true;
        saveStats();
      } else if (board.every(cell => cell !== "")) {
        drawSound.play();
        showPopup("ü§ù It's a Draw!");
        stats.draws++;
        gameOver = true;
        saveStats();
      } else {
        if (gameMode === 'vs-computer') {
          currentPlayer = "O";
          updateTurnIndicator();
          setTimeout(computerMove, 800);
        } else {
          currentPlayer = currentPlayer === "X" ? "O" : "X";
          updateTurnIndicator();
        }
      }
    }

    function computerMove() {
      let availableMoves = board.map((val, idx) => val === "" ? idx : null).filter(v => v !== null);
      let move;
      if (difficulty === 'easy') {
        move = availableMoves[Math.floor(Math.random() * availableMoves.length)];
      } else if (difficulty === 'medium') {
        move = Math.random() < 0.7 ? getBestMove() : availableMoves[Math.floor(Math.random() * availableMoves.length)];
      } else {
        move = getBestMove();
      }
      board[move] = "O";
      moveSound.play();
      renderBoard();
      if (checkWinner("O")) {
        winSound.play();
        showPopup('üòî Computer Wins!');
        stats.losses++;
        gameOver = true;
        saveStats();
      } else if (board.every(cell => cell !== "")) {
        drawSound.play();
        showPopup("ü§ù It's a Draw!");
        stats.draws++;
        gameOver = true;
        saveStats();
      } else {
        currentPlayer = "X";
        updateTurnIndicator();
      }
    }

    function getBestMove() {
      for (let i = 0; i < 9; i++) {
        if (board[i] === "") {
          board[i] = "O";
          if (checkWinner("O")) { board[i] = ""; return i; }
          board[i] = "";
        }
      }
      for (let i = 0; i < 9; i++) {
        if (board[i] === "") {
          board[i] = "X";
          if (checkWinner("X")) { board[i] = ""; return i; }
          board[i] = "";
        }
      }
      if (board[4] === "") return 4;
      const corners = [0,2,6,8].filter(i => board[i] === "");
      if (corners.length > 0) return corners[Math.floor(Math.random() * corners.length)];
      const available = board.map((val, idx) => val === "" ? idx : null).filter(v => v !== null);
      return available[Math.floor(Math.random() * available.length)];
    }

    function checkWinner(player) {
      const patterns = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
      return patterns.some(p => p.every(i => board[i] === player));
    }

    function updateTurnIndicator() {
      if (gameMode === 'vs-computer') {
        document.getElementById('turnIndicator').textContent = currentPlayer === "X" ? "üéÆ Your Turn (X)" : "ü§ñ Computer Thinking...";
      } else {
        document.getElementById('turnIndicator').textContent = `üë§ Player ${currentPlayer === 'X' ? '1' : '2'}'s Turn`;
      }
    }

    function showPopup(message) {
      popupMessage.textContent = message;
      popup.classList.add('active');
      popupOverlay.classList.add('active');
    }

    function restartGame() {
      popup.classList.remove('active');
      popupOverlay.classList.remove('active');
      startGame();
    }

    function backToMenu() {
      popup.classList.remove('active');
      popupOverlay.classList.remove('active');
      document.getElementById('roomCodeInput').value = '';
      document.getElementById('roomName').value = '';
      document.getElementById('roomInfo').classList.add('hidden');
      document.getElementById('loginUsername').value = '';
      document.getElementById('loginPassword').value = '';
      showPage('modePage');
      updateStatsDisplay();
    }

    function loadStats() {
      if (currentUser && users[currentUser]) {
        stats = users[currentUser].stats || { wins: 0, losses: 0, draws: 0 };
      }
    }

    function saveStats() {
      if (currentUser && users[currentUser]) {
        users[currentUser].stats = stats;
        localStorage.setItem('tictactoeUsers', JSON.stringify(users));
      }
    }

    function updateStatsDisplay() {
      loadStats();
      document.getElementById('winsDisplay').textContent = stats.wins || 0;
      document.getElementById('lossesDisplay').textContent = stats.losses || 0;
      document.getElementById('drawsDisplay').textContent = stats.draws || 0;
    }

    function resetStats() {
      if (confirm('Are you sure you want to reset all your stats?')) {
        stats = { wins: 0, losses: 0, draws: 0 };
        saveStats();
        updateStatsDisplay();
      }
    }

    // Start the app
    init();
  </script>
</body>
</html>
